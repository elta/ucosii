;*********************************************************************************************************
;                                               uC/OS-II
;                                         The Real-Time Kernel
;
;                          				(c) Copyright 2005, KInG
;                                          All Rights Reserved
;
; File    : isr_a.s
; Des	  : S3C2440용 ISR 
; by      : KInG(kimingoo@hotmail.com): 
; History : 2005.07.30: Uart1의 Receive ISR 작성
;*********************************************************************************************************

	IMPORT	OSIntEnter
	IMPORT	OSIntExit
	IMPORT	OSIntCtxSwFlag
	IMPORT	OS_IntCtxSw
	
	
	IMPORT  isrUart1RxD
	EXPORT  ISR_Uart1RxD
	
	AREA	UCOS_ISR , CODE, READONLY

ISR_Uart1RxD
	;----------------------------------------------------------------------------------	
	; 프로세서 레지스터 저장
	;----------------------------------------------------------------------------------	
	STMFD   SP!, {R0-R3, R12, LR}
        
	;----------------------------------------------------------------------------------	
	; OSIntEnter() 호출 또는 OSIntNesting 값을 1 증가;
	;----------------------------------------------------------------------------------		
	BL      OSIntEnter

	;----------------------------------------------------------------------------------		
	; isrUart1RxD();
	;----------------------------------------------------------------------------------	
	BL		isrUart1RxD
	
	;----------------------------------------------------------------------------------	
	; OSIntExit();
	;----------------------------------------------------------------------------------	
	BL      OSIntExit

	;----------------------------------------------------------------------------------	
	; if(OSIntCtxSwFlag == TRUE) _IntCtxSw();
	;----------------------------------------------------------------------------------	
	LDR     R0, =OSIntCtxSwFlag    	; See if we need to do a context switch
	LDR     R1, [R0]
	CMP     R1, #1
	BEQ     OS_IntCtxSw           	; Yes, Switch to Higher Priority Task

	;----------------------------------------------------------------------------------	
	; 프로세서 레지스터 복구;
	;----------------------------------------------------------------------------------	
	LDMFD   SP!, {R0-R3, R12, LR}   ; No, Restore registers of interrupted task''s stack
        
	;----------------------------------------------------------------------------------	
	; 인터럽트 복귀 명령 실행;
	;----------------------------------------------------------------------------------		
	SUBS    PC, LR, #4         		; Return from IRQ
	
	END